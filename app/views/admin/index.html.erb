<div class="w-full">

  <div class="flex justify-between items-center">
    <h1 class="font-bold text-4xl text-primary mt-1 mb-4">
      Demandes
    </h1>
    <%= link_to 'Nouvelle demande', new_demande_path, class: "btn btn-primary" %>
  </div>

  <%= form_tag admin_index_path, method: :get do %>
    <div class="flex flex-wrap xl:flex-nowrap">

    <div class="mr-4">
      <%= label_tag :search, "Rechercher", class: "label" %>
      <%= text_field_tag :search,
                      params[:search],
                      include_blank: true,
                      class: 'input select-bordered w-full max-w-xs',
                      onchange: 'this.form.submit()' %>
    </div>

    <div class="mr-4">
      <%= label_tag :type_document, "Type", class: "label" %>
      <%= select_tag :type_document, 
                      options_for_select(@demandes.type_documents, params[:type_document]), 
                      include_blank: true,
                      class: 'select select-bordered w-full max-w-xs', 
                      onchange: 'this.form.submit()' %>
    </div>

    <div class="mr-4">
      <%= label_tag :district, "District", class: "label" %>
      <%= select_tag :district, 
                      options_for_select(Demande.pluck(:district).uniq.sort, params[:district]), 
                      include_blank: true,
                      class: 'select select-bordered w-full max-w-xs', 
                      onchange: 'this.form.submit()' %>
    </div>

    <div class="mr-4">
      <%= label_tag :workflow_state, "État", class: "label" %>
      <%= select_tag :workflow_state, 
                      options_for_select(Demande.workflow_spec.states.keys.to_a, params[:workflow_state]), 
                      include_blank: true,
                      class: 'select select-bordered w-full max-w-xs', 
                      onchange: 'this.form.submit()' %>
    </div>

    </div>
  <% end %>

  <div id="disturbances" class="my-4 overflow-x-auto">
    <table class="table table-zebra w-full">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nom</th>
          <th>Date de naissance</th>
          <th>District</th>
          <th>État</th>
          <th>Demandeur</th>
          <th>MÀJ</th>
        </tr>
      </thead>
      <tbody>
        <% @demandes.each do | demande | %>
          <tr class="hover">
            <th class="font-normal">
              <p>
                <%= link_to demande.id, demande, class: 'link' %>
              </p>
            </th>

            <td>
              <p>
                <%= link_to demande.nom, demande, class: 'link' %>
              </p>
            </td>

            <td>
              <p>
                <%= demande.date_naissance %>
              </p>
            </td>

            <td>
              <p>
                <%= demande.district %>
              </p>
            </td>

            <td>
              <p>
                <span class="badge badge-<%= demande.style %>"><%= demande.workflow_state.humanize %></span>
              </p>
            </td>

            <td>
              <p>
                <%= demande.user.email %>
              </p>
            </td>

            <td>
              <p>
                <%= time_ago_in_words demande.updated_at %>
              </p>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

<%= page_entries_info @demandes, entry_name: 'demande' %>
<%= paginate @demandes %>
